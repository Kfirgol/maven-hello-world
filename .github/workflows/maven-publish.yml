name: maven-hello-world
on: [push]

jobs:
    build-and-push:
        runs-on: ubuntu-latest
        steps:
        
        - uses: actions/checkout@v4
          name: Checkout
        
        - name: Set up JDK 17
          uses: actions/setup-java@v4
          with:
            java-version: '17'
            distribution: 'temurin'
            cache: maven
 
        - name: update version with Maven
          run: mvn -B release:update-versions --file ./myapp/pom.xml
      
        - name: Get Version
          id: get-version
          run: |
            VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)
            echo $VERSION
            echo "VERSION=$VERSION" >> "$GITHUB_OUTPUT"

        - name: Login to Docker Hub
          uses: docker/login-action@v3
          with:
            username: ${{ secrets.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}
        - name: Build and push
          uses: docker/build-push-action@v5
          with:
            context: .
            build-args: VERSION=$VERSION
            push: true
            tags: barryallen696/maven:latest
          
#        - uses: mr-smithers-excellent/docker-build-push@v6
 #         env:
  #          VERSION: ${{steps.get-version.outputs.VERSION}}
   #       name: Build & push Docker image
    #      with:
     #       image: barryallen696/maven
      #      tags: $VERSION
       #     registry: docker.io
        #    dockerfile: ./myapp/Dockerfile
         #   username: ${{ secrets.DOCKER_USERNAME }}
          #  password: ${{ secrets.DOCKER_PASSWORD }}


 # multi-stage dockerfile example: https://stackoverflow.com/questions/27767264/how-to-dockerize-maven-project-and-how-many-ways-to-accomplish-it
 # marketplace: https://github.com/marketplace
 # build and push action: https://github.com/marketplace/actions/build-and-push-docker-images#examples