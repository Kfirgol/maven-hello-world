name: maven-hello-world
on: [push]

jobs:
    build-and-push:
        runs-on: ubuntu-latest
        outputs:
            output1: ${{steps.Version.outputs.version}}
        steps:
        - uses: actions/checkout@v4
        - name: Set up JDK 17
          uses: actions/setup-java@v4
          with:
            java-version: '17'
            distribution: 'temurin'
            cache: maven
        - name: update version with Maven
          run: mvn -B release:update-versions --file ./myapp/pom.xml
        - name: Version
          run: |
            VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)
            echo $VERSION
            echo "version=$VERSION" >> "$GITHUB_OUTPUT"

          - uses: mr-smithers-excellent/docker-build-push@v6
            name: Build & push Docker image
            with:
              image: barryallen696/maven
              tags: $VERSION
              registry: docker.io
              dockerfile: Dockerfile
              username: ${{ secrets.DOCKER_USERNAME }}
              password: ${{ secrets.DOCKER_PASSWORD }}
             
          
 # multi-stage dockerfile example: https://stackoverflow.com/questions/27767264/how-to-dockerize-maven-project-and-how-many-ways-to-accomplish-it
 # marketplace: https://github.com/marketplace
 # build and push action: https://github.com/marketplace/actions/build-and-push-docker-images#examples